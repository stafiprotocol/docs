# StaFi Chain Whitepaper

## Abstract

Proof-of-stake (PoS) consensus has taken the spotlight as the best alternative to the proof-of-work (PoW) consensus algorithm. PoS validates transactions based on tokens staked—not computing power as its PoW counterpart. Staking is the key to the proof-of-stake consensus, and on the strength of that approach, it's making its debut while claiming superiority over PoW. In the PoS system, staking provides safety by keeping it democratic — with everyone able to earn through participation in the consensus, it is in a way, solving the centralization  problem of computing power in PoW. However, this mechanism puts “staking” at “stake”. A problem arises with respect to staking; one that could bring down the entire network. There are several solutions for this problem, many of which involve maximizing rewards from network participation. Even so, these solutions may depreciate token value or lower network performance, which may endanger the network entirely.

At one end of the PoS spectrum, most projects are incorporating incentives to encourage a higher stake ratio for safety reasons. On the other end, they require staked tokens to be locked up for a certain period of time to prevent potential attacks from large token stakers. In the middle lies a paradox between the security of the main network and the ease of buying and selling tokens. That is to say, a system that locks up all staked tokens is highly secure, but its value growth is limited due to a lack of token liquidity.

Therefore, we have designed a decentralized protocol that will solve the liquidity issue faced by staked assets, enabling these assets to circulate freely. Through our decentralized protocol, users stake tokens through StaFi which will help networks maintain network security and ensure token liquidity simultaneously. We will do this by issuing a specialized token called rToken (abbreviation of “Reward Token”) as a voucher when users stake their tokens. The originally deposited tokens remain relatively static in comparison, this means that PoS networks that adopt StaFi will be sufficiently secure without compromising liquidity.

## Background

The proof-of-stake consensus algorithm originally debuted in November 2011 by Quantum Mechanic on the Bitcointalk Forum. An upgrade over PoW, PoS is a far more energy-efficient and sustainable method of blockchain maintenance. It replaces computational power — which requires significant amounts of electricity — with token staking in Block production within the system to validate transactions. This changes the concept of ‘mining’ to validating. Token holders may participate in Block production by staking their tokens. Block Producers (BP) are chosen through algorithm permissionlessly. BP’s selected are responsible for packing and verifying transactions, ultimately securing the network.
Even as a late-comer to the industry, PoS has gained huge popularity and extreme growth in terms of  consensus, elections, packing and validation of transactions compared to its PoW counterpart. As the blockchain technology further advances, PoS is taking the lead and being used in top projects such as Cardano, Tezos, Cosmos and Polkadot due to its sustainability, scalability and efficiency.
The PoS Staking Model has overturned PoW which utilizes computational power, replacing mining altogether. Token holders are able to participate in the network consensus through staking. There are two options present when staking; token holders may become validators through operating validator nodes or choose to delegate tokens to validators. Delegating to validators was impossible prior to 2015. Since then, the majority of popular PoS projects have introduced delegation techniques to further raise network staking ratios, which are intended to strengthen security.

Whether it's PoW or PoS, block rewards remain a crucial part of the consensus and are implemented to incentivize participation in validator node operations. Block Rewards are often increased prior to the launch of a mainnet that uses PoS consensus in order to ensure that enough tokens will be staked at launch. Therefore, initially distributed coins are often locked and will undergo an unbonding process in a set period of time to avoid systemic failure. As an example, Arthur Breitman, Founder of Tezos, has highlighted the importance of initial incentivization and it being paramount in ensuring a safe Mainnet launch in the Tezos Whitepaper. Stakers are made to bear this time cost to ensure the safety of the network. As a result, fewer holders may stake their tokens which gravely reduces safety to the network. This can be solved by incentivizing stakers with higher than usual yields at mainnet launch. The Cosmos Ecosystem implemented an annual yield that went as high as 7~20% to motivate stakers during their mainnet launch.

Redemption Periods are a vital feature that sets PoS apart from the PoW consensus. In the PoS model, they are used to prevent Long Range and Nothing At-Stake Attacks on the network. Redemption / Vesting Periods are a certain amount of time stakers will need to wait before receiving their tokens. Token holders are able to redeem their tokens at any time, however, tokens will not be tradeable until the redemption period ends. Stakers are left at the mercy of the market due to fluctuating token prices during this period. This presents a contradiction between staked token security and token liquidity.

The dilemma is problematic in both directions. Token holders are afraid to stake due to Redemption Periods imposed (to enhance security), which causes the network to have reduced security. This is a precarious situation causing a handful of stakers to reap the majority of the rewards while the network still remains insecure.  The staking rate for projects adopting the PoS consensus ranges widely from 20% ~ 80%. The ideal staking rate for maximized security is 100%, however, this is practically unattainable. A 100% staking rate would mean that the token has 0 liquidity. The liquidity of a token plays a significant role in a blockchains operations and creates value in a system. Hence, a project with 0 liquidity will be highly negative. At the moment, the PoS community has not agreed on a reasonable Staking rate. As a matter of fact, it is impossible to reach an agreement because testing a distributed network in a simulated environment is difficult.

StaFi offers a secure solution to the inverse relationship between mainnet security and token liquidity by introducing rTokens. rTokens are voucher tokens a user will receive when staking tokens through StaFi. For example, a user that stakes 1 XTZ will obtain an equivalent value amount of rXTZ (Reward XTZ). rXTZ is an interest bearing tokens and will increase in value on par with regular yields one might obtain by staking natively.

By staking in exchange for equivalent rTokens, the token holder obtains assets of equal value to the tokens. For instance, if a user stakes 1 XTZ, he will receive rXTZ (reward XTZ) equal to the original token. rXTZ represents regular token yields as well as XTZ ownership on the original chain. Simultaneously, rXTZ can be traded on supported markets and exchanges via StaFi Protocol. In contrast to staking tokens natively on their original chains; rTokens are constantly generating compounding returns while maintaining high liquidity. As a result, holders of rXTZ no longer need to endure the risk of volatility and make timely judgments based on market conditions. StaFi Protocol will allow stakers to be more flexible and agile in the market; ultimately returning the rights of stakers while maintaining high liquidity and security for the network.

With high flexibility and the ability to sell rTokens at any time to obtain its underlying value, stakers can once again stake confidently. This will result in staking rates increasing which ultimately leads to increased security for the entire network. In theory, projects that implement rTokens are able to reach a staking rate of 100% while maintaining high liquidity throughout the network.

## Existing Work — Unleashing Liquidity

The pre-existing ways of improving liquidity are scarce, which can be categorized into decentralized and centralized methods.

A centralized token circulation approach is frequently backed by a third party, which acquires token ownership from holders proceeded by intensive staking. Staked tokens will be utilized to generate blocks via validator nodes, resulting in staking rewards being generated. Once the third party has accumulated a sufficient number of tokens, it will be well-positioned to issue additional tokens to its clients. Thereafter, in partnership with a centralized exchange, a trading pair can be established with the issued tokens; or the project may launch a trading pair on any decentralized exchange.

Token holders may trade them over supported CEX/DEX to receive their underlying value as they represent the ownership (including redemption and income rights) of originally staked tokens without having to redeem them on the primary chain. As a result, the liquidity of staked tokens may be utilized, unlocking liquidity for the entire network. However, there are some drawbacks. This concept is unlikely to succeed without the trust of token holders towards a third party's endorsement and the legitimacy of its redemption and income rights. Even then, holders should also be aware of the third party’s capability of guaranteeing liquid trading pairs with the token which may depend on a variety of factors; such as the security that the third party stakes massively to create liquidity.

A small-scale third party is entitled the right to issue bonded assets, however, few may respond. This method of releasing liquidity also exists only in theory. Besides that, a network’s decentralization may be compromised if most of the tokens are minted by a single entity, this exposes the network to many security risks such as hacks which may potentially endanger user assets. Similar attacks have taken place frequently in the past involving Centralized Exchanges. Even when setting aside the security issues faced, this approach opposes the spirit of decentralization in the Blockchain Industry.

Another centralized approach to this problem relies on the cooperation between Project Developers and Centralized Exchanges. A project may fully endorse all assets that are staked to Central Exchanges. Projects may also delegate custody of staked tokens to the exchange (with the condition that permissions for staked tokens are exclusively held by Projects). By implementing this solution, Centralized Exchanges may issue derivatives and create multiple trading pairs to ensure high liquidity of staked tokens. Meanwhile, all redemptions are still supported on the Project’s network. This approach has disadvantages as well such as the inability to bypass centralized exchanges. This leads to increased security risks such as embezzlement and misappropriation of funds. These assumptions are based on past occurrences of theft on Centralized exchanges. In conclusion, the aforesaid two approaches completely deviates from the decentralized approach that is much preferred by the blockchain community.

Alternatively, Project Developers may restructure the underlying protocol to obtain a Project Base Liquid Token (PBLT, Project-Base Liquid Token) after staking original tokens. PBLT’s may be traded without needing to redeem them on the original network, this bypasses the need to wait long redemption periods while maintaining high security throughout the Project’s network. This approach brings convenience to stakers alike with the ability to redeem their underlying staked assets immediately. Additionally, the PBLT issued will be endorsed by a decentralized system-level entity, guaranteeing security for the entire network and its users. The rights entitled to the PBLT is recognized by the entire consensus permissionlessly. However, a potential problem arises in Project networks that are not willing to modify its underlying consensus due to its difficulty. This is not an all-rounded solution with hurdles along the way. At the time of writing, Cosmos and Near Protocol remains the only ecosystem putting forward their own ideas in implementing a similar solution. Holders of other blockchain assets are yet to provide a solution to this problem.

StaFi Protocol establishes a permissionless Staking Contract which allows users to initiate staking to obtain rTokens in return. These rTokens may be traded on the Application Layer to receive the value of their underlying staked assets. Staking and rToken issuance processes take place on an automated, permissionless audited smart contract. A third party endorsement is no longer required as users may stake and redeem their tokens at any time via smart contract which are automatically executed upon validation. Hence, rToken distribution rights are restored back to token holders with no involvement from any third party. Furthermore, rTokens act as a value-bearing bonded assets of their underlying staked assets, providing liquidity and security to its original chain.

The largest advantage from this approach is that bonded assets are issued by individuals instead of institutions, which helps the network resist volatility in the liquidity of its tokens by avoiding centralization from any one entity. In theory, this approach is highly decentralized and should greatly motivate original chain holders to stake with StaFi to obtain rTokens. The issuance of rTokens will be sufficient to support liquidity on the bonded asset’s markets and will encourage the trading of bonded assets, thereby reducing spot transactions.

The issuance of rTokens are endorsed by Staked Assets which are in turn, endorsed by the public chain implementing this model. At the time of writing, the Staking Model approach we have proposed has not been abused or compromised in any way, proving to be a secure and fair solution which guarantees its underlying staked asset. A disadvantage is that the value of bonded assets are highly dependent on its original token. Users may continue to earn yield through staking, however, may fluctuate according to the price movements of the original token, which in return causes inconsistency value and volatility to rTokens.

rTokens (Bonded Assets) are open to an infinite number of use cases, one of them being Leveraged Financing. Back in 2019 when a large number of PoS Consensus Projects were launched, staking was beginning to be more prevalent to the entire industry. Leveraging bonded assets will mean that the holder of the assets are also the debtor, causing staked tokens to serve as the collateral. Redemption rights of these tokens will shift as the collateral is traded. These transactions are stipulated entirely by smart contracts, bypassing centralized companies and institutions, which ultimately defines StaFi, a decentralized protocol for Staking that differs from other centralized solutions.

## StaFi Protocol

StaFi is a decentralized protocol that empowers the liquidity of staked assets on all 3 layers; Bottom, Contract and Application Layers. The Bottom Layer consists of a blockchain system based on Substrate. Substrate is a blockchain architecture developed by Parity, which includes multiple development modules such as the consensus, P2P, Staking modules, etc… The Contract Layer enables the creation of a variety of Staking Contracts (XTZ, ATOM, ETH, DOT and more). Token holders may stake through StaFi’s Staking Contract, which provides staking yields similar to ordinary staking, the difference being that rTokens are obtained by staking through StaFi. Lastly, the Application Layer supports third-party APIs to create a decentralized bonded asset trading market for rTokens that facilitates the circulation, transfer and trading on StaFi Protocol.

StaFi Protocol operates in a completely decentralized manner on Substrate, which will be connected to the Polkadot Network as a parallel chain, sharing the same underlying consensus. Hence, security and performance of StaFi is guaranteed by Polkadot. With the core layer being the Contract Layer, the ownership of Staked Tokens are fully guaranteed by audited Staking Contracts. StaFi implements a distributed key storage system to ensure the security of Staking Addresses through Multi-signatures.

Users staking their tokens via StaFi’s Staking Contracts will be able to receive passive compounded yield. Meanwhile, holders of rTokers may redeem their rTokens through our Contracts at any time and place without the need of any third party intervention. Redemption operations interact with the Original Chain through StaFi Protocol. Redemptions are transacted to the Original Chain; redeemed assets are sent to the users wallet after the redemption period ends. StaFi Protocol is able to guarantee that each and every rToken corresponds to their underlying assets on the Original Chain. rToken holders have the exclusive right to initiate redemption of the original token on the Staking Contract. rTokens represent underlying staked assets, hence, trading away rTokens will cause holders to lose their right to redeem those staked assets. Vice versa, a user that purchases rTokens on the market will be able to redeem those rTokens for their underlying staked assets. This entire process is fully decentralized and free from third party intervention.

On a separate note, third parties may establish a market for the exchange and trading of rTokens using StaFi Protocol at the Application Layer. All rTokens on Exchanges will collectively share the same depth of liquidity. With the number of PoS Chains increasing, the variety of tokens available to be staked will grow exponentially encouraging the trading of rTokens. Developers and teams that implement StaFi’s staking solution will be rewarded in the form of transaction fees from rToken transactions initiated.

## Implementation

### Staking Contract

StaFi’s Staking Contract (SC) interacts between the Original Chain at the Contract Layer. Let’s have a look at the example below for the Tezos’(XTZ) Staking Contract. User A initiates staking through XTZ-SC, a multi-signature address will be created. XTZ Tokens will be transferred to this address through the Tezos Chain. After the transaction is confirmed, the contract executes staking of the tokens from the multi-sig address. As a result, tokens are staked and locked on the Original Chain, Tezos. StaFi Protocol receives proof of Tezos tokens staked on the Original Chain (Proofs) and triggers the SC to generate rXTZ according to the current rate and transfers them to the User A’s wallet.

Further development of Staking Contracts will require the cooperation between StaFi Protocol and Original Chains. StaFi’s Staking Contracts share many similarities with cross-chain mechanisms, hence, the Contract Status of each OC will need to be monitored accordingly. The multi-sig account will be generated on StaFi Protocol. Simultaneously, user assets are transferred to the multi-sig address signed by the user occur on the OC. Once the signed transaction is confirmed, a staking request is initiated from the multi-sig address ono the OC. Once tokens are successfully staked on the OC, the SC captures and verifies the “State” of staked tokens on the OC and issues a corresponding amount of rTokens after successfully staking tokens.

Throughout the staking process, StaFi Protocol interacts with the OC multiple times. The monitoring and capture of the State of staked tokens plays a vital role for the entirety of the protocol. States are captured by time delay and multi-pass validation to ensure the final authenticity on the OC. Unlike it’s PoW counterpart, PoS projects require multiple block confirmations as a criteria that must be met to prove authenticity of transactions. As the latest height of a network is formed, transactions included are deterministic.

A common solution to ensure finality and timely determination of transactions is to verify the legality of the transaction before packaging the transaction to a new height. StaFi Protocol has implemented the Byzantine Fault-Tolerant (BFT) Algorithm in combination with an artificially specified fork penalty mechanism, Slashing. As a result, Stafi protocol has heightened security when interacting with original PoS consensus chains.

### Multi-signature Adresses

At the present time of writing, the majority of Staking Models rely on the Account Model, which requires a Private Key on the OC address to be signed during the Staking Process. To ensure the exclusivity between the ownership of staked assets and rTokens, StaFi has designed an Intermediate Address Model (IAM). This model implies that assets under the multi-sig address do not belong to anyone. Being fully permissionless, the Private Keys of this address are not owned by any one person or entity.

StaFi guarantees the asset neutrality of intermediate addresses through secure multi-party computing technology and threshold multi-signing technology, ensuring that signatures are only performed when the holder of rTokens initiates a redemption. Secure multi-party computing involves high privacy, which requires a group of certifiers with special functions in Stafi to participate. A certain number of validators, known as StaFi Special Validators (SSV) signs their own private keys and transmits it through a secure channel to verify the validity of the signature. Finally, the intermediate address signature can then be restored. The intermediate address does not have a private key, nor is it stored on Stafi protocol. It is formed through the signing of the private certificate from specific authenticators only when required. The implementation of threshold multi-signing technology requires a partial amount (not all) of authenticators to generate the private key signature, which satisfies the criteria for the signature. For example, a multi-sign address establishes contact through a public key of multiple validators (say 21). During the redemption of rTokens, only 16 out of 21 signatures are required to verify Staking and Redemption operations for Assets on StaFi.

### Secure Multi-Party Computation

StaFi’s Secure Multi-Party Computation focuses on the calculations of predefined functions without the dependence towards untrusted third parties. The implementation of this method of computation addresses a problem reliant on multi-party data calculations whereby the involved parties are not willing to share original data. By implementing Secure Multi-Party Computation, the final result (output) may be securely verified without revealing initial input values to any third party. StaFi’s SC requires a new multi-sig address to be created every single time tokens are staked. Hence, during Redemption of rTokens, private keys are created with the involvement of StaFi Special Validators (SSV) as a computational resource. Calculation results are encrypted and verified without the need of revealing the Private Keys of SSV’s. In conclusion, the StaFi’s Secure Multi-Party Computation will ensure exceptional security in the unlocking and redemption operations of the SC.

### Ownership Transfer

The redemption rights of XTZ on the multi-sig address are exclusive to holders of rXTZ. Holders of rXTZ may exercise their right to redeem via the XTZ-SC at any given time. For example, User A has decided to trade XTZ with user B, User A will lose redemption rights to redeeming XTZ. Concurrently, the address recorded in the contract is also changed to match user B. Finally, user B may initiate the redemption of XTZ tokens according to their wishes, transfer them to other people, or swap them on an exchange to receive their underlying value at any given time.

From this process, the multi-sig address will be able to transfer multiple rounds of ownership on the Original Chain through the validation of SSV’s (StaFi Special Validators), which differ from Polkadot’s solution ; it does not require a block-producing consensus. This is only required for the generation of addresses and transfer of ownership. From the same example above, when user A trades rTokens to user B, special validators (SSVs) will verify the signature and complete the transfer of rXTZ.

## StaFi Special Validator (SSV)

StaFi Special Validator are distinct from StaFi Validators (SV) and play an important role in the StaFi Chain. SSV’s are trusted as witnesses for asset ownership on SC’s. During the redemption of rTokens, SSV’s are tasked to provide computational data and complete the transfer of assets from the multi-sig address to user wallets. When there are no redemptions occurring on-chain, SSV’s store their own private keys locally, awaiting to be called. \

SSV’s are composed of multiple validators selected randomly through an algorithm which selects and N number of SSV’s from SV’s. Calculations performed by SSV’s are done locally and transmitted through an encrypted channel. After validation, participation rights are obtained and stored locally on their respective servers. This entire process is automated by the system.

At the same time, each and every SSV will be required to run the light node of the projects supported by Stake Contract, in order to verify the original chain trading status. This program is written to the entire special validator client and the validation is performed automatically.

### SSV Group

In order to ensure the redemptions take place ideally, special certifiers (SSV Group) on Stafi are utilized in groups with fixed shifts. During their respective shifts, a single certifier group completes the generation of multi-sig addresses and storage of Secret Keys. After an execution cycle ends, the SSV Group is replaced by a new group. This ensures the engagement of the current verifier. One term of validators lasts for one Era (1 Era ~ 24hours). The election of the next group is performed in the previous Era. StaFi selects new SSVs from SV candidates by comparing block-producing rate, Staking ratio, and more. New SSVs will replace old SSV Private Keys with their own respective ones. Meanwhile, the system will remove any relationship established with the SSV private keys. However, frequent replacement of SSV Groups may affect computational efficiency. During the launch of the StaFi mainnet, a reasonable replacement cycle duration will be chosen to balance safety and efficiency.

### Incentivizations and Penalties for Special-Validators

Due to the importance of StaFi Special Validators, StaFi has established a system of incentivizations and penalties for them to stimulate positive behaviors such as computations and storage, and in contrast, punish negative behaviors such as disconnections and non-timely replacements. Stipulated by Stafi protocol, the participation in generation of addresses, computing, and signatures will be rewarded with the StaFi token, FIS. On the other hand, StaFi will penalize validators that compromise the security of the network. StaFi requires all validators involved in computing and storage to maintain a determined uptime. If the validator frequently disconnects, it will be slashed. In the occurrence that the time disconnected is longer than N hours, the validator will be Jailed and will not be able to participate in any computing and storage for the Special Validator Group for a period of time. IAdditionally, the system severely punishes attacks that attempt to recover private keys and steal assets based on provable data on the chain.

### Staking Mechanism for Special-Validators

Any StaFi Token holder may apply as a Special Validator. SSV’s are required to stake FIS Tokens. The amount of rewards generated will be proportional to the amount of tokens staked. For example, the more FIS staked, the greater the computation and storage. The Incentivization and Penalties set by the StaFi system will be purposed to circumvent bad actors and reward good ones. Due to StaFi’s unique ecosystem, extra precautions are taken especially at the inception by limiting the number of Verifiers and nodes of the Mainnet and gradually increasing them as stability is observed.

### Staking Contract Security

There are multiple ways of securing a Staking Contract. The security of assets when using StaFi’s SC’s are guaranteed in many ways. StaFi has implemented various security measures to ensure maximized security across our contracts. Firstly, asset neutrality ensures staked assets are locked on their respective Original Chains and mapped on the Staking Contract. The multi-sig address generated is also secured by N SSV’s through Threshold Multi-signal Sharing Technology. This essentially frees SC’s from being subjected to any third party making them self-sufficient and sustainable. Multi-sig addresses also employ an Asset Mechanism verified by Special Validators selected randomly by StaFi’s Algorithm. The verifiers do not know each other, hence, the possibility of collusion is unprobable, and asset protection will be dynamically replaced within a certain period to ensure security.The verifiers do not know each other, the possibility of collusion becomes small, and the asset protection will be dynamically replaced within a certain period to ensure security. Lastly, a Slashing Mechanism is implemented in the event of attacks or illegal behaviour of Validators. Validators will lose a portion of staked FIS during slashing which is calculated proportionally to the total value of assets staked. When combined, the methods mentioned above may effectively punish misbehaving parties while rewarding good ones. Under the assumption that the majority of validators are honest, the security of assets under Staking Contracts are guaranteed

### Decentralization of Staking Contract Assets

All staking assets staked through a Staking Contract will be fulfilled by a single contract. Although staking is initiated by a single address, the degree of decentralization is not usually affected. However, when staked assets are too concentrated in a single address, they are more prone to attacks by malicious parties. StaFi avoids this problem by establishing several Staking Contracts of the same kind for a single token. The total amount of contracts will increase automatically according to the value of staked assets. Moreover, multiple Staking Contracts are established in the early stages, distributing initially staked tokens evenly to each contract to serve as a buffer.

Stafi is a decentralized and open-source protocol. The Staking Contracts developed by initial developers will be audited and open sourced to third parties, which may create their own Staking Contracts to achieve the decentralization of Staking assets.

### Sequence Diagram

StaFi’s Staking process is explained in this section. Firstly, a user interacts with the SC followed by the SC interacting with the original chain. To simplify user inputs, SC’s are designed to interact with the Original Chain multiple times. It is vital that StaFi’s SC verifies that assets have been successfully staked before distributing rTokens to users. The following sequence diagram shows the overall process of issuing rTokens.

Users may receive the assets staked on the original chain by redeeming the rTokens they hold at any time. SC’s will require the signature of the SSV’s during redemption, due to the record relationship/mapping of the assets made initially on the SC. During redemption, the SC triggers a signature request. After SSV’s executes the signature, the SC interacts with the original chain and submits an Unbond/Unstake request. Subsequently, SSV’s verify ownership on the original chain. When conditions are met, rTokens redeemed will be destroyed.

## Upper-layer Applications

### Circulation of Bonded Assets

Staking Contracts on StaFi allows staking derivatives, rTokens, to be created and circulate on the StaFi Ecosystem. This ultimately allows users to trade these rTokens to receive their underlying value of staked assets without the need of redemption periods usually required on Original Chains. Additionally, StaFi’s system guarantees an exclusive correspondence between rTokens and original chain assets allowing holders to redeem on the Original Chain at any given time.

In addition to rTokens circulating on Stafi protocol, staked assets may also be listed on external trading channels, such as centralized trading exchanges (CEX). CEX’s may utilize StaFi’s proprietary interface to define the initial pricing of different rTokens to avoid initial volatility. Transaction prices of each asset may fluctuate depending on *n* and may employ the use of various pricing models. Further cooperation between exchanges can be discussed to integrate StaFi SC’s to integrate OC staked assets to an exchange. In conclusion, the docking of assets and transactions may easily be integrated into exchanges.

### rToken exchange market

Stafi Protocol will provide a variety of Staking contracts for the projects looking to launch Staking Derivatives on StaFi. Additionally, to ensure sufficient liquidity, the system will evaluate different types of rTokens and establish a risk-control model. Using that model, the system can further issue FIS as StaFi’s medium of exchange in the redemption of rTokens for users who want to exchange rTokens to other assets with low liquidity/pairings. The exchange ratio is determined by the market and priority level. Additionally issued FIS and the usage of rTokens exposes FIS holders to certain risks, in which, will be beared by all parties to reduce the chances of bad debts. Meanwhile, due to the price difference between rToken and FIS, the system will benefit from arbitrage during rToken redemptions. All rTokens are designed and act in accordance with this model.

### A New Liquidity Token Protocol

Stafi Protocol, which is based on SC, may provide liquidity for locked staking assets. Meanwhile, Stafi Protocol can create more types of SCs for various Staking assets. Developers may freely build a variety of derivatives on StaFi through SC Development Kits provided by Stafi.

### Integration with Existing DeFi

Integration with existing DeFi mainly lies on liquidity of respective assets. Present-day DeFi projects are mainly on developed Ethereum, which uses ERC20 Tokens. However, many ERC20 tokens are relatively poor in liquidity. Thus, the Staking Derivative Markets can be utilized to increase liquidity as well as asset portfolios for networks through DeFi. Staked tokens may circulate by bridging to existing lending and borrowing platforms.

### Tokenomics

Stafi Protocol creates value by offering liquidity for staked assets. Users may earn staking rewards while actively trading their rTokens to respond to market movements. The protocol captures the value of this liquidity and redistributes it within the ecosystem. FIS is the native digital utility token of the Stafi Protocol, representing various functions specified in the protocol code. It plays a significant role in the functioning of the Stafi Protocol ecosystem and is intended for use exclusively as a primary utility token within the platform. It is cryptographically secured and transferable.

FIS is a non-refundable utility token that serves as a medium of exchange for transactions between participants on Stafi Protocol. Its introduction aims to provide a secure and convenient mode of payment and settlement for those interacting within the Stafi Protocol ecosystem. It is not intended for use as a general medium of exchange or for paying for goods and services outside of those provided by the issuer. FIS does not convey any ownership, participation, rights, titles, or interests to the Foundation, Distributor, their affiliates, or any other company or enterprise. It also does not entitle token holders to any promise of fees, dividends, revenue, profits, or investment returns, and is not considered a security in Singapore or any other jurisdiction. Its use is restricted to Stafi Protocol, and owning FIS grants only the right to use it as a means for enabling usage and interaction within the protocol.

Stafi Protocol creates various staking contracts to support different staking tokens. These tokens are locked on their original blockchain to receive inflation rewards. When users transfer or redeem their rToken, a fee based on the earned staking rewards, called the Liquid Fee, will be charged. This fee is proportional to the reward.

As the use and expansion of the Stafi Protocol's staking contracts (SC) increases, the fees based on staking rewards will also increase. Currently, the market value of staking tokens is approximately 1.4 billion USD, with around 60% of those tokens locked. It is estimated that when StaFi Protocol supports staking tokens from ETH, XTZ, ATOM, and EOS, and 10% of those tokens are staked through StaFi, the revenue generated from the fees collected by the protocol will be significant.

To calculate the fees earned by Stafi:

$\text { Earning }=\sum_{v}(v * \alpha * \beta * \gamma)$

v - market value of different Staking Tokens
α - locked token ratio
β - annual inflation rate
γ - circulation fee rate

(With the assumption that circulation fee is 30%, the average inflation reward is 5%, and the average Staking rate is 50 %.)

The value captured by StaFi is used to balance the ecosystem. The development and implementation of staking contracts (SC) is a significant source of income for StaFi Protocol. Inflation is used to encourage decentralization within StaFi Protocol. FIS tokens are distributed to provide economic incentives that encourage participants to contribute to and maintain the ecosystem. Each block produced requires validators to contribute computing, bandwidth, and storage resources. Additionally, FIS generated by the same block is used to compensate for these efforts. The protocol's design also requires higher-level validators to provide security services such as multi-signature, light node, and oracle machine services, which are also incentivized through the distribution of FIS tokens. FIS is an integral part of StaFi Protocol, as it provides the necessary incentives for users to expend resources and participate in activities that benefit the entire ecosystem. Only active participants on StaFi Protocol and/or holders of FIS will receive these incentives.

The annual inflation rate is calculated by adding together all ecosystem incentives. The design of the inflation rate is a complex economic problem, and research has shown that the inflation rate for proof-of-stake (PoS) projects is generally set between 5% and 20% per year, with most adjusting dynamically based on the overall staking rate.

StaFi Protocol's initial annual inflation rate is divided into two parts for validators, SV and SSV respectively. The annual inflation rate for SV is dynamically adjusted between 2.5% and 10% based on the staking rate, while the annual inflation rate for SSV is dynamically adjusted between 1% and 2% based on the number of service calls. Theoretically, the total inflation rate will decrease over time as the adoption of SC increases.

### Token Model

StaFi Protocol implements two types of tokens: Alternative Tokens (rToken) and Native Tokens (FIS). These tokens have different functions within the protocol. rToken serves primarily as a medium for liquidity and inherits equity and attributed functions/rights from its natively staked token. FIS serves as the native token of the StaFi Protocol is primarily used as a transaction medium and is responsible for value capture, consensus incentives, and preventing system abuse (through transaction fees).

### Staking of Validators and Incentives

In order to incentivize validators and prevent mischief, an open proof-of-stake (PoS) network requires validators to stake FIS as a form of security deposit before participating in validation. After completing calculations and storage, validators are entitled to receive FIS rewards from the system. The staked FIS will be locked, and if the validator engages in mischief or wrongdoing, the locked FIS will be slashed. SSVs are elected from the SVs based on criteria such as online time and the ratio of free tokens to staked tokens. In general, for the safety of contract assets, the system stipulates that the amount of staked FIS is proportional to the amount of staked assets that can be processed, meaning that the more FIS is staked, the more staked contract assets can be processed and the more FIS rewards can be earned. If the system detects dishonest behavior by SSVs, the system will also slash the staked FIS, with the proportion of the slash depending on the severity of the mischief.

### Transaction Fees

The stake contract created on the StaFi Protocol obtains rToken through staking on the original chain. The rToken circulated on the StaFi Protocol must pay FIS to obtain computing power. Validators package the transaction and upload it to the latest block data. Once the latest block height is updated, the rToken transaction is completed. The amount of FIS transaction fees is based on the size of the transaction data that needs to be processed. The fee model for ordinary transactions is as follows:

$\text { Fee } \left.{t x}=c{\text {traffic }} *(\text { basefee }+ \text { type }(t x) * \text { lenthOf }(t x))+\text { weight }(t x)\right)$

The FIS transaction fee is determined by the transaction data size and the current network traffic. The fee is calculated using the Ctraffic parameter, which is adjusted dynamically according to the network traffic, the type of transaction (tx), and the base fee. The lengthOf(tx) function determines the size of the transaction data, while the weight(tx) function considers the duration and status of the transaction.

The final fee is expressed in FIS, and if the paid amount exceeds the resources required for system operation, the excess will be returned to the contract account after the transaction has been completed. In the case that there are insufficient FIS to be used as payment, the system will not execute the transaction.

### Call Staking Contracts

The StaFi Protocol offers multiple interfaces for third-party use. When a contract is called, it consumes system computing resources. To prevent low-cost attacks and ensure a certain level of commercial viability, the caller must pay a certain amount of computing resources when the contract call frequency reaches a certain level. The payer of these resources can be customized, either by the platform user or the platform itself. The overall fee model is priced in FIS, with the system calculating the computing and storage resources required for the call and comparing them to the FIS paid by the caller to determine the final fee.

All transaction fees generated by the protocol will be distributed between the validators (SVs) and the Protocol Treasury in a predetermined ratio. This ratio can be modified through online governance.

### Protocol Treasury

The Protocol Treasury is a fund established to support the long-term development and operation of StaFi protocol. It is funded by a portion of the transaction fees, inflation incentives, circulation fees, slash deposits, and other sources generated by the protocol. Through an online governance system, holders of FIS are able to vote on proposals related to the platform's parameters and features. It is important to note that the right to vote is limited to decisions regarding the StaFi Protocol and does not entitle holders of FIS to vote on the management or operation of the Foundation, Distributor, or their affiliates, or on any assets held by these entities. It also does not constitute any equity interest in these entities.

Given that the FIS in the Protocol Treasury is not utilized within a certain period of time, a token burning strategy will be implemented. In the early stages, the Protocol will be actively seeking participation, so the Foundation will have control over the use and burning of the Protocol Treasury. As the protocol becomes more established, the use of the Protocol Treasury will be opened up to the community.

### The Initial Distribution of Tokens

The Staking Drop Program is a mechanism designed by StaFi to stimulate the early adoption of the platform and increase the overall value of StaFi through the expansion of staking contracts (SCs). It is a long-term campaign that will be held annually, with different airdrop periods tailored to specific projects based on their lock-up periods. A single project may be eligible for multiple airdrops, however the scale may decrease over time. The initial incentive is set at a high level to encourage more token holders to engage in staking.

Participation in the Staking Drop program is open to all users who hold FIS and stake their tokens through Staking Contracts. The amount of reward received is directly proportional to the total value of staked tokens and the amount of work performed. These rewards are distributed in the form of community incentives, which are paid in FIS.

For more about the Tokenomics of StaFi, please checkout StaFi Tokenomics Whitepaper.

## Summary

StaFi Protocol aims to improve the liquidity of staking assets by providing a decentralized alternative asset issuance platform. As more proof-of-stake (PoS) public chains are launched and the market value of staking assets is expected to reach $100 billion in the next 2-3 years, the liquidity of these assets may decrease due to their need for staking. StaFi will focus on issuing staking derivatives without the need for third-party trust, and will also enable the issuance of alternative staking asset products across multiple chains. This will address the tension between the liquidity and security of staking assets.  StaFi will also support future assets such as XTZ, ATOM, DOT, and DFN through the issuance of rTokens, which provide a platform for projects seeking even greater liquidity.
As a benchmark asset in the world of decentralized finance (DeFi), rTokens derived from native tokens can be used to develop financial derivatives without compromising the security of the original chain. As such, StaFi Protocol is expected to become an essential infrastructure for DeFi. This is a key goal for future development efforts.

## Work in Future

In order for rTokens to achieve widespread adoption and for derivatives based on rTokens to thrive, several challenges must be overcome, including technological and trust-building challenges. Ensuring the security of the staking assets managed by the StaFi Protocol is critical for the success of the protocol, as without this security, there will be no stakers interested in staking. By ensuring the security of the protocol is enforced, StaFi may also withstand cybersecurity attacks and black swan events, even with a large number of staking assets. With a secure foundation, developers may be more likely to build additional applications and derive more assets based on rTokens. Therefore, there is significant work to be done in order to ensure the success of StaFi Protocol. 

**On-chain Governance**

As a decentralized protocol, StaFi's direction of development is closely tied to governance. Many proof-of-stake (PoS) consensus projects use token staking as a voting method, and the implementation of this method may vary. Some projects may try to increase voter participation through incentives, while others may provide market predictions as a reference for voting, or use a delegation system to avoid converging voting results. StaFi recognizes that there are many challenges with voting in reality, including low participation and criticisms of voting results. Providing more references and incentives can help to address these issues, but a perfect solution has yet to be found. Most existing solutions are indirect and rely on blockchain optimization, which can lead to new problems. Therefore, voting is a tricky issue that requires careful consideration. While blockchain can improve efficiency, it has not yet solved some fundamental issues. StaFi plans to implement basic voting logic in the initial stage and eventually upgrade to on-chain governance logic, with the goal of eventually finding a solution to the voting problem through long-term optimization.

**Private-key Maintenance Methods**

Currently, the private key signature for multi-signature addresses is secured through Threshold Multi-signature Algorithm with the participation of multiple special validators. The validator's private key is stored on the certifier's local server (after being encrypted), however, asset custody and the validator's existence are not permanent, which may lead to disagreements and compromising the security of the assets. To address this, StaFi guarantees the randomness and timeliness of private key storage through regular rotation. Frequent replacement of validators can be resource-intensive, hence the frequency should be kept at a reasonable level. The optimal frequency has not yet been determined. Part of the future work will focus on finding a balance between frequency and safety.

Additionally, Threshold Multi-signature Technology still requires trusting random verifiers. StaFi is researching new algorithms that may reduce the need for trust to improve protocol security. Privacy computing technologies such as MPC and TEE may offer cooperative opportunities for the security model required by StaFi. These technologies are rapidly advancing, with numerous projects and applications emerging. Therefore, StaFi will continue to explore these technologies in the future work on the contract layer.

**Distributed Smart Contracts**

When an individual initiates the staking process through a staking contract, their tokens are locked on the original chain. The security of these tokens is ensured through the security mechanisms of the original blockchain. However, the existence of cross-chain bonded assets, known as rTokens, implies that the mapping relationship of the asset's multi-signature account is stored in the staking contract. As more tokens on the original blockchain are staked, the contract becomes more vulnerable to attacks. While the mapping relationship is not a determining factor in the redemption of original chain assets, an attack on the staking contract could compromise the overall system.

To address this issue, StaFi has developed a distribution system that generates staking contracts based on the value of the staked assets. Each staking contract has a threshold value, and when this value is reached, staking from that contract will cease and a new contract will be created. This dynamic approach helps to prevent asset centralization and reduce the risk of large assets being targeted in attacks.

There are also advanced industry practices that can ensure that staking contracts do not have full control over locked staking assets. When a staking contract is called, an independent contract with only the rights of the holders is created. This contract is closely tied to a single staker and is audited by a third-party agency before being released.

**The Safety of Assets on the Original Chain**

The issuance of rTokens are based on proof from the original blockchain. Hence, rTokens are only minted and sent to corresponding users once staking has occurred on the original blockchain. StaFi Protocol ensures a unique correspondence between rTokens and assets on the original blockchain, ensuring the ability to redeem these assets. However, if there is a problem with the Staking Module on the original blockchain, the value of rTokens may decrease. For example, if a user stakes 10 XTZs, they will receive 10 rXTZs (at a rate of 1:1). If the value of XTZs decreases to 5 XTZs due to a slash, the value of rXTZs will also decrease accordingly, potentially resulting in rXTZs and XTZs to become unpegged. To prevent this, StaFi has implemented a risk control and compensation mechanism, which is described in further detail in the third article of the Staking Contract series, "Risk Control Framework for Staking Contract". 

This mechanism is still being refined and is a priority for StaFi moving forward.

**Distribution of Alternative Tokens**

rTokens issued through StaFi represent various rights associated with the originally staked tokens such as redemption rights, income rights, voting rights, and other ecosystem rights. Currently, Staking Contracts enable basic redemption and income rights, and are working towards realizing rights and interests corresponding to the original chain for rTokens, moreover, even providing additional rights and interests on other chains.

It is important to ensure the fairness of the distribution of these rights. This requires further refinement and will improve in the future. The mechanisms for distributing rights may vary across different proof-of-stake public chains, which can make it challenging to perfect the access to Staking Contracts. It is important to establish a universal rights distribution mechanism to reduce development difficulties and improve user satisfaction. StaFi currently uses a simple and straightforward method for distributing rights and interests to stakers, adhering to the principle of the public sharing risk and rewards. However, this method may not align with the original chain mechanism, which could lead to confusion. There are still many challenges to be addressed in this area.

**Issuing More Alternative Tokens besides Staking Assets**

The core of StaFi is the issuance of alternative tokens based on staked assets. However, there is potential to expand the underlying assets used to issue these alternative tokens to include a broader range of encrypted assets, or even assets that are not encrypted. If this were to be achieved, it would significantly increase the scope and potential of StaFi. This is a medium to long-term direction that is worth considering and exploring.
